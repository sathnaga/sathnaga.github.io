---
layout: post
title: Testing KVM through libvirt environment using Avocado Test Framework
date: '2018-05-17T16:53:00.000+05:30'
author: Satheesh
tags:
- testing
- linux
- kvm
- avocado
- automation
- libvirt
- powerpc
modified_time: '2018-05-17T18:51:36.872+05:30'
blogger_id: tag:blogger.com,1999:blog-3781127847171836973.post-7800585854692947756
blogger_orig_url: http://www.sathnaga86.com/2018/05/testing-kvm-through-libvirt-environment.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><h2><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><i>This blog explains about my patch to avocado-vt framework to enable tp-libvirt tests to run independent&nbsp;of guest import and delete_guest tests as we run tp-qemu tests.</i></span></h2><div><b><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><i><br /></i></span></b></div><h3 style="text-align: left;"><u><i><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Introduction to Avocado Test Framework:</span></i></u></h3>Refer my previous blog titled `<a href="https://sathnaga86.com/2018/05/17/testing-kvm-on-power-using-avocado-test.html" target="_blank">Testing KVM on Power Using Avocado Test Framework</a>`<br /><div><br /><h3 style="text-align: left;"><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><u>Patches that are needed to support below enablement:</u></span></h3><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><a href="https://github.com/avocado-framework/avocado-vt" rel="nofollow" target="_blank">avocado-vt</a>: <span style="color: blue;">*</span></span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">2c3ad894 Add param to cleanup env</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">e6df69b7 Enable libvirt vm start in preprocess</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">44773144 Undefine libvirt vm using param during postprocess</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><span style="color: blue; font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: x-small;"><i>* already merged upstream</i></span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span></div><h3 style="text-align: left;"><u><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Steps to setup avocado in host and to run tp-libvirt tests:</span></u></h3><i><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Make sure your host has all packages installed which are needed to run&nbsp;KVM guests through&nbsp;libvirt.</span></i><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><b><i>Below tests results are on Fedora28&nbsp;in IBM Power8 host and it has been verified with no change to tests, framework in x86 aswell.</i></b></span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><span style="color: blue; font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: x-small;"><i>Installing avocado...</i></span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">#git clone https://github.com/avocado-framework/avocado.git -b 68.0</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">#cd avocado</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">#make requirements-selftests</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">#python setup.py install</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><span style="color: blue; font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: x-small;"><i>Installing avocado-vt...</i></span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">#git clone https://github.com/avocado-framework/avocado-vt.git</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">#cd avocado-vt</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">#make requirements</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">#python setup.py install</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><span style="color: blue; font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: x-small;"><i>Bootstrapping to get guest(VM) image and tests...</i></span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">#avocado vt-bootstrap --vt-type libvirt</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">------------&gt;&nbsp;<i>Say yes to download JeOS guest image</i></span><br /><div><br /><span style="color: blue; font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: x-small;"><i>Running tests...</i></span></div><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"># avocado run guestpin --vt-type libvirt --vt-extra-params create_vm_libvirt=yes kill_vm_libvirt=yes env_cleanup=yes backup_image_before_testing=no restore_image_after_testing=no vcpu_cores=2 smp=2 --vt-guest-os JeOS.27.ppc64le</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">JOB ID&nbsp; &nbsp; &nbsp;: cacac07981928e019bc4d967e1be5166e85da7b1</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">JOB LOG&nbsp; &nbsp; : /home/sath/avocado-fvt-wrapper/results/job-2018-05-17T03.24-cacac07/job.log</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(01/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.randompin.positive.with_host_smt: CANCEL (36.27 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(02/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.randompin.positive.with_guest_smt: PASS (76.74 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(03/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.randompin.positive.with_save: PASS (87.26 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(04/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.randompin.positive.with_managedsave: PASS (88.58 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(05/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.randompin.positive.with_suspend: PASS (47.47 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(06/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.randompin.positive.iteration: PASS (56.97 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(07/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.randompin.positive.with_stress.guestcpu: PASS (677.52 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(08/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.randompin.positive.with_stress.guestmem: PASS (676.46 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(09/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.randompin.positive.with_cpu_hotplug: PASS (60.73 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(10/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.sequential.positive.with_host_smt: CANCEL (43.77 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(11/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.sequential.positive.with_guest_smt: PASS (76.49 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(12/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.sequential.positive.with_save: PASS (86.65 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(13/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.sequential.positive.with_managedsave: PASS (87.97 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(14/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.sequential.positive.with_suspend: PASS (46.27 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(15/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.sequential.positive.iteration: PASS (57.30 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(16/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.sequential.positive.with_stress.guestcpu: PASS (676.80 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(17/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.sequential.positive.with_stress.guestmem: PASS (676.28 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(18/37) type_specific.io-github-autotest-libvirt.guestpin.without_emulatorpin.sequential.positive.with_cpu_hotplug: PASS (60.49 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(19/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.with_host_smt: CANCEL (44.20 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(20/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.with_guest_smt: PASS (77.16 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(21/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.with_save: PASS (87.70 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(22/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.with_managedsave: PASS (88.20 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(23/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.with_suspend: PASS (47.04 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(24/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.iteration: PASS (56.09 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(25/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.with_stress.guestcpu: PASS (677.03 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(26/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.with_stress.guestmem: PASS (238.97 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(27/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.with_cpu_hotplug: PASS (60.24 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(28/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.randompin.positive.with_load_switch: PASS (679.63 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(29/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.sequential.positive.with_host_smt: CANCEL (43.70 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(30/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.sequential.positive.with_guest_smt: PASS (76.70 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(31/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.sequential.positive.with_save: PASS (88.16 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(32/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.sequential.positive.with_managedsave: PASS (87.71 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(33/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.sequential.positive.with_suspend: PASS (46.95 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(34/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.sequential.positive.iteration: PASS (57.66 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(35/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.sequential.positive.with_stress.guestcpu: PASS (676.51 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(36/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.sequential.positive.with_stress.guestmem: PASS (249.92 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">&nbsp;(37/37) type_specific.io-github-autotest-libvirt.guestpin.with_emualorpin.sequential.positive.with_cpu_hotplug: PASS (59.96 s)</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;">RESULTS&nbsp; &nbsp; : PASS 33 | ERROR 0 | FAIL 0 | SKIP 0 | WARN 0 | INTERRUPT 0 | CANCEL 4</span><br /><div><br /><br /></div><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Feel free to run any number of tests just with these params enabled which will automatically create VM in libvirt environment irrespective of test configs.</span><br /><span style="color: blue; font-family: &quot;times&quot; , &quot;times new roman&quot; , serif; font-size: xx-small;"><br /></span><i><span style="color: blue;"><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">create_vm_libvirt=yes kill_vm_libvirt=yes env_cleanup=yes</span></span></i><br /><br /><div style="color: black; font-family: &quot;times new roman&quot;; font-style: normal; font-weight: 400; letter-spacing: normal; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px;"><div style="text-align: left;"><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Here, I have a run&nbsp;<i>guestpin</i>&nbsp;test from tp-libvirt which tests different combinations of vcpupin and emulatorpin libvirt apis and it is evident from below run that no&nbsp;<i>guest import and delete guest</i>&nbsp;tests are used and no additional changes to test case are required!!.</span></div></div><div><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><span style="font-family: &quot;times new roman&quot;;"><i><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Many more tests are available which can be browsed by `</span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">avocado list -V --vt-type=qemu`</span></i></span></span><br /><div><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><span style="font-family: &quot;times new roman&quot;;"><i><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span></i></span></span></div><br /></div><div><i><span style="color: blue;">Hope this helps you in someways!!</span></i></div><div><i><span style="color: blue;">Thanks for taking time in reading this blog....</span></i></div></div>
